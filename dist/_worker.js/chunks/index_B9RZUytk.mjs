globalThis.process ??= {}; globalThis.process.env ??= {};
function F(e){return e?`/auth/login/${e}`:"/auth/login"}var A="/",W=(e,t)=>(e.endsWith(A)&&(e=e.slice(0,-1)),t.startsWith(A)||(t=A+t),e+t),R=(e,t,o)=>{let a=e.pathname===A?t:W(e.pathname,t),s=new globalThis.URL(a,e);if(o)for(let[c,n]of Object.entries(J(o)))if(n&&typeof n=="object"&&!Array.isArray(n))for(let[p,u]of Object.entries(n))s.searchParams.set(`${c}[${p}]`,String(u));else s.searchParams.set(c,n);return s};function $(e){return typeof e!="object"||!e?false:"headers"in e&&"ok"in e&&"json"in e&&typeof e.json=="function"&&"text"in e&&typeof e.json=="function"}async function k(e){if(!(typeof e!="object"||!e)){if($(e)){let t=e.headers.get("Content-Type")?.toLowerCase();if(t?.startsWith("application/json")||t?.startsWith("application/health+json")){let o=await e.json();if(!e.ok||"errors"in o)throw o;return "data"in o?o.data:o}if(t?.startsWith("text/html")||t?.startsWith("text/plain")){let o=await e.text();if(!e.ok)throw o;return o}return e.status===204?null:e}if("errors"in e)throw e;return "data"in e?e.data:e}}var D=async(e,t,o=globalThis.fetch)=>(t.headers=typeof t.headers=="object"&&!Array.isArray(t.headers)?t.headers:{},o(e,t).then(a=>k(a).catch(s=>{let c={errors:s&&typeof s=="object"&&"errors"in s?s.errors:s,response:a};return s&&typeof s=="object"&&"data"in s&&(c.data=s.data),Promise.reject(c)})));var L=()=>{let e=null;return {get:async()=>e,set:async t=>{e=t;}}};var _={msRefreshBeforeExpires:3e4,autoRefresh:true},H=2**31-1,ne=(e="cookie",t={})=>o=>{let a={..._,...t},s=null,c=null,n=a.storage??L(),p=async()=>n.set({access_token:null,refresh_token:null,expires:null,expires_at:null}),u=async()=>{try{await s;}finally{s=null;}},f=async()=>{let d=await n.get();return s||!d?.expires_at||d.expires_at<new Date().getTime()+a.msRefreshBeforeExpires&&I().catch(l=>{}),u()},b=async d=>{let l=d.expires??0;d.expires_at=new Date().getTime()+l,await n.set(d),a.autoRefresh&&l>a.msRefreshBeforeExpires&&l<H&&(c&&clearTimeout(c),c=setTimeout(()=>{c=null,I().catch(x=>{});},l-a.msRefreshBeforeExpires));},I=async(d={})=>(s=(async()=>{let x=await n.get();await p();let m={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in a&&(m.credentials=a.credentials);let i={mode:d.mode??e};e==="json"&&x?.refresh_token&&(i.refresh_token=x.refresh_token),m.body=JSON.stringify(i);let h=R(o.url,"/auth/refresh");return D(h.toString(),m,o.globals.fetch).then(y=>b(y).then(()=>y))})(),s);async function C(d,l={}){await p();let x=d;"otp"in l&&(x.otp=l.otp),x.mode=l.mode??e;let m=F(l.provider),i=R(o.url,m),h={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)};"credentials"in a&&(h.credentials=a.credentials);let y=await D(i.toString(),h,o.globals.fetch);return await b(y),y}return {refresh:I,login:C,async logout(d={}){let l=await n.get(),x={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in a&&(x.credentials=a.credentials);let m={mode:d.mode??e};e==="json"&&l?.refresh_token&&(m.refresh_token=l.refresh_token),x.body=JSON.stringify(m);let i=R(o.url,"/auth/logout");await D(i.toString(),x,o.globals.fetch),this.stopRefreshing(),await p();},stopRefreshing(){c&&clearTimeout(c);},async getToken(){return await f().catch(()=>{}),(await n.get())?.access_token??null},async setToken(d){return n.set({access_token:d,refresh_token:null,expires:null,expires_at:null})}}};var pe=e=>t=>{let o=e??null;return {async getToken(){return o},async setToken(a){o=a;}}};var G={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},le=(e,t={})=>{let o=t.globals?{...G,...t.globals}:G;return {globals:o,url:new o.URL(e),with(a){return {...this,...a(this)}}}};function j(e){return ["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(e)}var Ut=(e,t,o)=>()=>{let a=String(e);if(j(a))throw new Error("Cannot use createItem for core collections");return {path:`/items/${a}`,params:o??{},body:JSON.stringify(t),method:"POST"}};var U=e=>{let t=(o,a=[])=>{if(typeof o=="object"){let s=[];for(let c in o){let n=o[c]??[];if(Array.isArray(n))for(let p of n)s.push(t(p,[...a,c]));else if(typeof n=="object")for(let p of Object.keys(n)){let u=n[p];for(let f of u)s.push(t(f,[...a,`${c}:${p}`]));}}return s.flatMap(c=>c)}return [...a,String(o)].join(".")};return e.flatMap(o=>t(o))},J=e=>{let t={};Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=U(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort=typeof e.sort=="string"?e.sort:e.sort.join(",")),typeof e.limit=="number"&&e.limit>=-1&&(t.limit=String(e.limit)),typeof e.offset=="number"&&e.offset>=0&&(t.offset=String(e.offset)),typeof e.page=="number"&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(","));for(let[o,a]of Object.entries(e))o in t||(typeof a=="string"||typeof a=="number"||typeof a=="boolean"?t[o]=String(a):t[o]=JSON.stringify(a));return t};var r=(e,t)=>{if(e.length===0)throw new Error(t)};var Q=(e,t)=>{if(j(String(e)))throw new Error(t)};var Ls=(e,t)=>()=>(r(String(e),"Collection cannot be empty"),Q(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),Gs=(e,t,o)=>()=>(r(String(e),"Collection cannot be empty"),Q(e,"Cannot use readItem for core collections"),r(String(t),"Key cannot be empty"),{path:`/items/${e}/${t}`,params:o??{},method:"GET"});var Vm=e=>()=>({path:"/users/me",params:e??{},method:"GET"});var Gn=(e,t,o,a)=>()=>(r(String(t),"Key cannot be empty"),r(String(e),"Collection cannot be empty"),Q(e,"Cannot use updateItem for core collections"),{path:`/items/${e}/${t}`,params:a??{},body:JSON.stringify(o),method:"PATCH"});var Bp=(e,t,o={})=>()=>({path:"/users/register",method:"POST",body:JSON.stringify({email:e,password:t,...o})});var M={},ju=(e={})=>t=>{let o={...M,...e};return {async request(a){let s=a();if(s.headers||(s.headers={}),"Content-Type"in s.headers?s.headers["Content-Type"]==="multipart/form-data"&&delete s.headers["Content-Type"]:s.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in s.headers)){let u=await this.getToken();u&&(s.headers.Authorization=`Bearer ${u}`);}let c=R(t.url,s.path,s.params),n={method:s.method??"GET",headers:s.headers??{}};"credentials"in o&&(n.credentials=o.credentials),s.body&&(n.body=s.body),s.onRequest&&(n=await s.onRequest(n)),o.onRequest&&(n=await o.onRequest(n));let p=await D(c.toString(),n,t.globals.fetch);return "onResponse"in s&&(p=await s.onResponse(p,n)),"onResponse"in e&&(p=await e.onResponse(p,n)),p}}};

export { Bp as B, Gs as G, Ls as L, Ut as U, Vm as V, Gn as a, ju as j, le as l, ne as n, pe as p };
