---
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import HoverBlock from '../../components/HoverBlock.astro';
import * as m from '../../paraglide/messages.js';

export const prerender = false;

const { id } = Astro.params;

// Récupérer les détails de l'artiste depuis l'API
let artist = null;
let error = null;

try {
  const response = await fetch(`${Astro.url.origin}/api/artists/${id}`);
  const data = await response.json();
  
  if (data.success) {
    artist = data.artist;
    console.log(artist)
  } else {
    error = data.message || 'Artist not found';
  }
} catch (e) {
  console.error('Error fetching artist:', e);
  error = 'Failed to load artist data';
}

// Si pas d'artiste trouvé, redirection 404
if (!artist) {
  return Astro.redirect('/404');
}
---

<Layout title={`${artist.artistName} - Wavmap`} description={artist.bio || `Découvrez le profil de ${artist.artistName}`}>
  <div class="min-h-screen bg-gray-50">
    <Navbar currentPage="map" />

    <HoverBlock 
      defaultText="Artist name"
      hoverText={artist.artistName}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="City"
      hoverText={artist.city}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="Country"
      hoverText={artist.country}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="role"
      hoverText={artist.artistName}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="style"
      hoverText={artist.artistName}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="social media"
      hoverText={artist.artistName}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="email"
      hoverText={artist.email}
    />
    <div class="separator" />

    <HoverBlock 
      defaultText="bio"
      hoverText={artist.bio}
    />
    <div class="separator" />
    <!-- <main class="py-12">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        Profile Header
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h1 class="text-3xl font-bold text-gray-900 mb-2">{artist.artistName}</h1>
              {artist.realName && (
                <p class="text-lg text-gray-600">({artist.realName})</p>
              )}
              {artist.pronouns && (
                <p class="text-sm text-gray-500">{artist.pronouns}</p>
              )}
            </div>
            <div class="text-right">
              <p class="text-lg font-semibold text-gray-700">📍 {artist.city}, {artist.country}</p>
              <p class="text-sm text-gray-500">Member since {new Date(artist.createdAt).toLocaleDateString()}</p>
            </div>
          </div>

          {artist.bio && (
            <div class="mb-6">
              <h2 class="text-xl font-semibold text-gray-800 mb-3">Bio</h2>
              <p class="text-gray-700 leading-relaxed">{artist.bio}</p>
            </div>
          )}

          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div>
              <h3 class="text-lg font-semibold text-gray-800 mb-3">🎵 Activities</h3>
              <div class="flex flex-wrap gap-2">
                {artist.activities.map(activity => (
                  <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                    {activity}
                  </span>
                ))}
              </div>
            </div>

            <div>
              <h3 class="text-lg font-semibold text-gray-800 mb-3">🎶 Musical Styles</h3>
              <div class="flex flex-wrap gap-2">
                {artist.genres.map(genre => (
                  <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">
                    {genre}
                  </span>
                ))}
              </div>
            </div>
          </div>

          {(artist.soundcloud || artist.spotify || artist.instagram) && (
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">🔗 Links</h3>
              <div class="flex flex-wrap gap-4">
                {artist.soundcloud && (
                  <a 
                    href={artist.soundcloud} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="bg-orange-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-orange-600 transition-colors"
                  >
                    🎵 SoundCloud
                  </a>
                )}
                {artist.spotify && (
                  <a 
                    href={artist.spotify} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="bg-green-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-600 transition-colors"
                  >
                    🎧 Spotify
                  </a>
                )}
                {artist.instagram && (
                  <a 
                    href={`https://instagram.com/${artist.instagram.replace('@', '')}`} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="bg-pink-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-pink-600 transition-colors"
                  >
                    📷 Instagram
                  </a>
                )}
              </div>
            </div>
          )}

          {artist.socialPolitical && artist.socialPolitical.length > 0 && (
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">✊ Social & Political Engagement</h3>
              <div class="flex flex-wrap gap-2">
                {artist.socialPolitical.map(topic => (
                  <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">
                    {topic}
                  </span>
                ))}
              </div>
            </div>
          )}

          {artist.themesDevelopment && (
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">💭 Themes & Development</h3>
              <p class="text-gray-700 leading-relaxed">{artist.themesDevelopment}</p>
            </div>
          )}

          {artist.clubPolitics && (
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">🏛️ Club Politics</h3>
              <p class="text-gray-700 leading-relaxed">{artist.clubPolitics}</p>
            </div>
          )}
        </div>

        <div class="text-center">
          <a 
            href="/map" 
            class="bg-primary-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-700 transition-colors inline-flex items-center gap-2"
          >
            ← Back to Map
          </a>
        </div>

      </div>
    </main> -->
  </div>
</Layout>

<style>
  /* Custom scrollbar for long content */
  main::-webkit-scrollbar {
    width: 8px;
  }

  .separator {
    height: 1px;
    width: 100%;
    background-color: black;
  }
  
  main::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  
  main::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
  }
  
  main::-webkit-scrollbar-thumb:hover {
    background: #a1a1a1;
  }
</style>