---
import Layout from '../layouts/Layout.astro';
import * as m from '../paraglide/messages.js';
---

<Layout title="404 - Page Not Found | Wavmap" noindex={true}>
  <main class="min-h-screen flex items-center justify-center px-4" style="background: linear-gradient(to right, #8FD116, #3E44E6 50%, #E9930F 80%, #E92C0F 100%);">
    <div class="max-w-lg w-full text-center">
      <div class="bg-white/90 backdrop-blur-sm p-8 border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)]">
        <!-- 404 Icon -->
        <div class="mb-8">
          <div class="mx-auto w-32 h-32 bg-black flex items-center justify-content center relative">
            <div class="text-white text-6xl font-black absolute inset-0 flex items-center justify-center">!</div>
            <div class="absolute -top-2 -right-2 w-8 h-8 bg-[#E92C0F] border-2 border-black transform rotate-12"></div>
          </div>
        </div>

        <!-- Error Message -->
        <h1 class="text-6xl font-black text-black mb-4 uppercase tracking-wider">404</h1>
        <h2 class="text-2xl font-black text-black mb-4 uppercase tracking-wide">
          {m.pageNotFound ? m.pageNotFound() : 'Page Not Found'}
        </h2>
        <p class="text-black font-bold mb-8">
          {m.pageNotFoundMessage ? m.pageNotFoundMessage() :
          'Sorry, the page you\'re looking for doesn\'t exist or has been moved. Let\'s get you back on track!'}
        </p>

        <!-- Action Buttons -->
        <div class="space-y-4">
          <a
            href="/map"
            class="block w-full bg-black text-white py-3 px-6 border-4 border-black font-black uppercase tracking-wide hover:bg-white hover:text-black hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:transform hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all"
          >
            {m.goToMap ? m.goToMap() : 'Explore the Map'}
          </a>

          <div class="flex space-x-3">
            <a
              href="/"
              class="flex-1 bg-[#A4A4A4] text-black py-3 px-4 border-4 border-black font-black uppercase tracking-wide hover:bg-white hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:transform hover:translate-x-[-1px] hover:translate-y-[-1px] transition-all"
            >
              {m.goHome ? m.goHome() : 'Home'}
            </a>
            <a
              href="/about"
              class="flex-1 bg-[#A4A4A4] text-black py-3 px-4 border-4 border-black font-black uppercase tracking-wide hover:bg-white hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:transform hover:translate-x-[-1px] hover:translate-y-[-1px] transition-all"
            >
              {m.about ? m.about() : 'About'}
            </a>
          </div>

          <button
            onclick="handleGoBack()"
            class="w-full text-black hover:text-[#E92C0F] text-sm font-black py-2 uppercase tracking-wide transition-colors"
          >
            {m.goBack ? m.goBack() : '‚Üê Go Back'}
          </button>
        </div>

        <!-- Popular Links -->
        <div class="mt-8 pt-6 border-t-4 border-black">
          <h3 class="text-sm font-black text-black mb-4 uppercase tracking-wide">
            {m.popularPages ? m.popularPages() : 'Popular Pages'}
          </h3>
          <div class="flex flex-wrap gap-2 justify-center">
            <a href="/map" class="text-xs bg-[#8FD116] text-black px-3 py-1 border-2 border-black font-bold uppercase hover:bg-white hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all">
              {m.artistMap ? m.artistMap() : 'Artist Map'}
            </a>
            <a href="/about" class="text-xs bg-[#3E44E6] text-white px-3 py-1 border-2 border-black font-bold uppercase hover:bg-white hover:text-black hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all">
              {m.about ? m.about() : 'About'}
            </a>
            <a href="/blog" class="text-xs bg-[#E9930F] text-black px-3 py-1 border-2 border-black font-bold uppercase hover:bg-white hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all">
              {m.blog ? m.blog() : 'Blog'}
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  function handleGoBack() {
    // Try to go back, but fallback to map if no history
    if (window.history.length > 1) {
      window.history.back();
    } else {
      window.location.href = '/map';
    }
  }

  // Smart redirection based on URL patterns
  function handleSmartRedirection() {
    const currentPath = window.location.pathname;
    const searchParams = new URLSearchParams(window.location.search);

    // Common redirect mappings
    const redirectMap: Record<string, string> = {
      '/login': '/map',
      '/register': '/map',
      '/dashboard': '/map',
      '/admin': '/map',
      '/api': '/map',
      '/user': '/map',
      '/users': '/map',
      '/artist': '/map',
      '/artists': '/map',
      '/posts': '/blog',
      '/post': '/blog',
      '/articles': '/blog',
      '/article': '/blog',
      '/news': '/blog',
      '/contact': '/about',
      '/help': '/about',
      '/support': '/about',
      '/faq': '/about',
    };

    // Check for partial matches
    for (const [pattern, redirect] of Object.entries(redirectMap)) {
      if (currentPath.startsWith(pattern)) {
        // Show message and redirect after 3 seconds
        setTimeout(() => {
          window.location.href = redirect;
        }, 3000);

        // Update the UI to show redirect info
        const redirectInfo = document.createElement('div');
        redirectInfo.className = 'mt-4 p-3 bg-[#8FD116] border-2 border-black text-black font-bold text-sm';
        redirectInfo.innerHTML = `Redirecting to ${redirect} in 3 seconds...`;
        document.querySelector('.space-y-4')?.after(redirectInfo);
        return;
      }
    }

    // If it looks like an old blog post URL, redirect to blog
    if (currentPath.includes('/blog/') || currentPath.includes('/article/') || currentPath.includes('/post/')) {
      setTimeout(() => {
        window.location.href = '/blog';
      }, 3000);

      const redirectInfo = document.createElement('div');
      redirectInfo.className = 'mt-4 p-3 bg-[#8FD116] border-2 border-black text-black font-bold text-sm';
      redirectInfo.innerHTML = 'This article may have been moved. Redirecting to blog in 3 seconds...';
      document.querySelector('.space-y-4')?.after(redirectInfo);
    }
  }

  // Run smart redirection on load
  document.addEventListener('DOMContentLoaded', handleSmartRedirection);
</script>

<style>
  /* Enhanced animation for the 404 number */
  h1 {
    animation: glitch 3s infinite;
  }

  @keyframes glitch {
    0%, 95%, 100% {
      transform: translateX(0) translateY(0);
    }
    2% {
      transform: translateX(-2px) translateY(1px);
    }
    4% {
      transform: translateX(-2px) translateY(-1px);
    }
    6% {
      transform: translateX(2px) translateY(1px);
    }
    8% {
      transform: translateX(-2px) translateY(-1px);
    }
    10% {
      transform: translateX(2px) translateY(1px);
    }
  }

  /* Icon animation */
  .mx-auto.w-32.h-32 {
    animation: shake 4s infinite;
  }

  @keyframes shake {
    0%, 90%, 100% {
      transform: rotate(0deg);
    }
    2% {
      transform: rotate(1deg);
    }
    4% {
      transform: rotate(-1deg);
    }
    6% {
      transform: rotate(1deg);
    }
    8% {
      transform: rotate(-1deg);
    }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    h1 {
      font-size: 3rem;
    }

    .mx-auto.w-32.h-32 {
      width: 6rem;
      height: 6rem;
    }

    .text-6xl {
      font-size: 2rem;
    }
  }
</style>